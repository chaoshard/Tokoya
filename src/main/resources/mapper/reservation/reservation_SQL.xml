<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper
	namespace="com.nurinubi.tokoya.reservation.repository.ReservationRepository">
	<select id="getReservationListByToday" resultType="Map">
   <![CDATA[  
    SELECT 
    	a.RESERVATIONID, a.RESERVATIONDATE, a.RESERVATIONSTATUS, 
    	b.COURSETIME,  
    	c.STYLISTID, c.STYLISTNAME
    FROM TRNRESERVATION a
    	LEFT JOIN MSTCOURSE b ON b.COURSEID = a.COURSEID
		LEFT JOIN MSTSTYLIST c ON a.STYLISTID = c.STYLISTID
	WHERE a.RESERVATIONDATE > DATE_FORMAT(NOW(), '%Y%m%d') 
    AND 
    RESERVATIONDATE < DATE_FORMAT(Date_Add(NOW(), INTERVAL+1 DAY), '%Y%m%d') 
    ]]>
	</select>
	<resultMap id="courseList" type="java.util.HashMap">
		<result javaType="java.lang.String" column="COURSEID" property="id" />
		<result javaType="java.lang.String" column="COURSENAME"
			property="name" />
		<result javaType="java.lang.String" column="COURSEPRICE"
			property="price" />
		<result javaType="java.lang.String" column="COURSETIME"
			property="time" />
	</resultMap>

	<resultMap id="staffList" type="java.util.HashMap">
		<result javaType="java.lang.String" column="STYLISTID"
			property="id" />
		<result javaType="java.lang.String" column="STYLISTNAME"
			property="name" />
	</resultMap>

	<select id="getCourseList" resultMap="courseList">
		SELECT
		COURSEID,
		COURSENAME,
		COURSEPRICE,
		COURSETIME
		FROM
		MSTCOURSE
	</select>

	<select id="getStaffList" parameterType="Map" resultMap="staffList">
		SELECT
		STYLISTID,
		STYLISTNAME
		FROM MSTSTYLIST
		WHERE (
		STYLISTID NOT IN (
		SELECT STYLISTID
		FROM TRNSTYLISTSCHEDULE
		WHERE OFFDATE = #{date}
		)
		) AND (
		STYLISTID NOT IN (
		SELECT STYLISTID
		FROM TRNRESERVATION
		WHERE RESERVATIONDATE = #{time}
		)
		);
	</select>
</mapper>